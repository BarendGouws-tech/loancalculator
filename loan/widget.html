<!-- loan/widget.html -->
<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Loan Repayment Calculator</title>
<style>
  :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial; }
  .card { max-width: 560px; margin: 24px auto; padding: 16px; border: 1px solid #e5e7eb; border-radius: 12px; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
  label { font-size: 0.9rem; color: #374151; display:block; margin-bottom: 4px; }
  input, select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; }
  .result { margin-top: 16px; padding: 12px; background: #f9fafb; border-radius: 10px; font-weight: 600; }
  .muted { color: #6b7280; font-size: 0.9rem; }
</style>
<div class="card">
  <h2>Loan Repayment Calculator</h2>
  <div class="row">
    <div>
      <label>Amount</label>
      <input id="amount" type="number" min="0" step="0.01" value="100000" />
    </div>
    <div>
      <label>Annual interest rate (%)</label>
      <input id="rate" type="number" min="0" step="0.01" value="12" />
    </div>
  </div>
  <div class="row">
    <div>
      <label>Term</label>
      <input id="term" type="number" min="1" step="1" value="120" />
    </div>
    <div>
      <label>Term unit</label>
      <select id="unit">
        <option value="months" selected>Months</option>
        <option value="years">Years</option>
      </select>
    </div>
  </div>

  <div class="result">
    Monthly instalment: <span id="out">–</span>
    <div class="muted" id="note"></div>
  </div>
</div>

<script>
  const qs = new URLSearchParams(location.search);
  const currency = qs.get("currency") || "ZAR";

  const amount = document.getElementById("amount");
  const rate   = document.getElementById("rate");
  const term   = document.getElementById("term");
  const unit   = document.getElementById("unit");
  const out    = document.getElementById("out");
  const note   = document.getElementById("note");

  const fmt = new Intl.NumberFormat(undefined, { style: "currency", currency, maximumFractionDigits: 2 });

  function calc() {
    const P = Number(amount.value || 0);
    const annualPct = Number(rate.value || 0);
    const n = (unit.value === "years") ? Number(term.value || 0) * 12 : Number(term.value || 0);
    const r = annualPct / 100 / 12;

    let m;
    if (n <= 0) { out.textContent = "—"; note.textContent = ""; return; }
    if (r === 0) {
      m = P / n; // zero-interest edge case
      note.textContent = "Zero interest assumed.";
    } else {
      const p = Math.pow(1 + r, n);
      m = P * r * p / (p - 1);
      note.textContent = `Effective monthly rate = ${(r*100).toFixed(4)}% | Term = ${n} months`;
    }
    out.textContent = fmt.format(m);
  }

  [amount, rate, term, unit].forEach(el => el.addEventListener("input", calc));
  calc();
</script>
</html>
